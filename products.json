import requests
from bs4 import BeautifulSoup
import json

url = "https://ec.volvocartw.com/accessory/SearchByTag/all"
headers = {"User-Agent": "Mozilla/5.0"}

try:
    response = requests.get(url, headers=headers)
    response.raise_for_status()  # 確保請求成功
except requests.exceptions.RequestException as e:
    print(f"❌ 請求失敗：{e}")
    exit()

soup = BeautifulSoup(response.text, "html.parser")

products = []
product_cards = soup.select(".productBox")

for card in product_cards:
    name_tag = card.select_one(".productName")
    price_tag = card.select_one(".price")
    img_tag = card.select_one("img")
    link_tag = card.select_one("a")

    if not (name_tag and price_tag and img_tag and link_tag):
        continue  # 跳過不完整的商品

    name = name_tag.text.strip()
    price_text = price_tag.text.strip().replace(",", "").replace("NT$", "")
    try:
        price = int(price_text)
    except ValueError:
        price = 0

    image = img_tag["src"]
    if not image.startswith("http"):
        image = "https://ec.volvocartw.com" + image

    product_id = link_tag["href"].split("/")[-1]

    products.append({
        "id": product_id,
        "name": name,
        "price": price,
        "image": image
    })